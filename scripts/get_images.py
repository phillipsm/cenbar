from binascii import a2b_base64
from bs4 import BeautifulSoup
import sys, time, os
from urlparse import urlparse
from selenium import webdriver
import random

reload(sys)
sys.setdefaultencoding('utf-8')


list_of_departments_address = 'path to staff directory'
driver = webdriver.Chrome('/Users/phillipsm/dev_area/poster/chromedriver')


# get directory page
driver.get(list_of_departments_address);
time.sleep(50)
driver.get(list_of_departments_address);

# get all hrefs with is-secure class on directory page
soup = BeautifulSoup(driver.page_source, "html.parser")
departments = soup.find_all("a", class_="is-secure")
departments.pop(0) #a more clever selector would avoid this silly cleanup

word_file = "/usr/share/dict/words"
WORDS = open(word_file).read().splitlines()

for department in departments:
	# cleanup the staff directory name for use as a folder name
	department_name = department.string
	department_name = department_name.replace('Staff Directory', '').rstrip()
	department_name = department_name.replace(' ', '-')
	"".join([c for c in department_name if c.isalpha() or c.isdigit() or c=='-'])

	image_store_path = 'images/' + department_name.lower()

	if not os.path.exists(image_store_path):
		# Some departments are repeated
		os.makedirs(image_store_path)

		driver.get(department['href'].replace('10', '1000'))
		soup = BeautifulSoup(driver.page_source, "html.parser")
		images = soup.select('table.table img')

		for image in images:
			data = image['src']

			# empty image
			if data != "data:image/jpg;base64,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":
				#trim out the (html5?) stuff at the start
				
				binary_data = a2b_base64(data[22:])
				fd = open(image_store_path + '/' + random.choice(WORDS).lower() + '.png', 'wb')
				fd.write(binary_data)
				fd.close()

	time.sleep(4)



# we're done with selenium, let's shut things down
driver.quit()